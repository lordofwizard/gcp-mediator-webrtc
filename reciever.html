<!DOCTYPE html>
<html>
<head>
    <title>WebRTC Receiver</title>
</head>
<body>
    <h1>WebRTC Receiver</h1>
    <video id="remoteVideo" autoplay></video>
    <script>
        const signalingServerUrl = 'ws://localhost:8080';
        const remoteVideo = document.getElementById('remoteVideo');
        let pc = new RTCPeerConnection();

        // Connect to the signaling server
        const signalingSocket = new WebSocket(signalingServerUrl);
        signalingSocket.onmessage = async (message) => {
            const signal = JSON.parse(message.data);
            if (signal.offer) {
                await pc.setRemoteDescription(new RTCSessionDescription(signal.offer));
                const answer = await pc.createAnswer();
                await pc.setLocalDescription(answer);
                signalingSocket.send(JSON.stringify({ answer: answer }));
            } else if (signal.answer) {
                await pc.setRemoteDescription(new RTCSessionDescription(signal.answer));
            } else if (signal.iceCandidate) {
                await pc.addIceCandidate(new RTCIceCandidate(signal.iceCandidate));
            }
        };

        // Handle ICE candidates
        pc.onicecandidate = (event) => {
            if (event.candidate) {
                signalingSocket.send(JSON.stringify({ iceCandidate: event.candidate }));
            }
        };

        // Add remote stream to video element
        pc.ontrack = (event) => {
            remoteVideo.srcObject = event.streams[0];
        };
    </script>
</body>
</html>
